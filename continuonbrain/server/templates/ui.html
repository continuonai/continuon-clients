<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Continuon Robot Editor</title>
    <link rel="stylesheet" href="/static/ui.css">
</head>

<body class="ide-body fullwidth">
    <div class="ide-shell wide">
        <header class="ide-topbar sticky">
            <div class="brand">
                <div class="brand-mark">ü§ñ</div>
                <div>
                    <div class="brand-title">Continuon Robot Editor</div>
                    <div class="brand-subtitle">One brain, many shells</div>
                </div>
            </div>
            <div class="tool-nav">
                <button class="tool-btn" onclick="window.setMode('manual_control')">Manual</button>
                <button class="tool-btn" onclick="window.setMode('autonomous')">Autonomous</button>
                <button class="tool-btn" onclick="window.setMode('sleep_learning')">Sleep Learning</button>
                <button class="tool-btn ghost" onclick="window.setMode('idle')">Idle</button>
                <div class="divider"></div>
                <!-- New view navigation -->
                <button class="tool-btn" onclick="window.setViewMode('owner')">Command</button>
                <button class="tool-btn" onclick="window.setViewMode('planning')">Planning</button>
                <button class="tool-btn" onclick="window.setViewMode('docs')">Docs</button>
                <button class="tool-btn" onclick="window.setViewMode('manual')">Controls</button>
                <button class="tool-btn" id="research-view-btn"
                    onclick="window.setViewMode('research')">Research</button>
                <div class="divider"></div>
                <button class="tool-btn" onclick="openSettingsModal()">Settings</button>
                <button class="tool-btn" onclick="window.openPairingModal()">Pair App</button>
                <button class="tool-btn ghost" onclick="window.triggerSafetyHold()">Safety Hold</button>
                <button class="tool-btn ghost" onclick="window.resetSafetyGates()">Reset Gates</button>
            </div>
            <div class="top-status">
                <div class="chip" id="mode">Loading...</div>
                <div class="chip" id="recording">No</div>
                <div class="chip" id="motion">No</div>
                <div class="chip" id="model-stack-chip">Model stack: detecting‚Ä¶</div>
            </div>
        </header>

        <!-- Action Log Strip Removed -->

        <div class="workspace-grid" id="workspace-grid">
            <!-- LEFT COLUMN -->
            <section class="column left-column resizable" data-column="left"
                style="display: flex; flex-direction: column; gap: 0; overflow: hidden;">
                <!-- LOGGER COMPONENT -->
                <div id="logger-panel" class="panel soft"
                    style="flex: 0 0 150px; display: flex; flex-direction: column; overflow: hidden; margin-bottom: 0; padding: 0; border-bottom: 1px solid var(--border);">
                    <div class="panel-header" style="padding: 8px 12px; background: rgba(0,0,0,0.2);">
                        <div class="panel-eyebrow">System Log</div>
                    </div>
                    <div id="ui-log-entries"
                        style="flex: 1; overflow-y: auto; padding: 8px 12px; font-family: monospace; font-size: 11px; color: var(--muted); display: flex; flex-direction: column-reverse;">
                        <!-- Log lines will be appended here -->
                        <div class="log-line system">[System] Logger ready.</div>
                    </div>
                </div>

                <!-- CHAT SURFACE -->
                <div id="chat-panel" class="panel soft"
                    style="flex: 1; display: flex; flex-direction: column; margin: 0; border-top: none; border-radius: 0 0 14px 14px; overflow: hidden;">
                    <div class="panel-header" style="padding: 12px;">
                        <div>
                            <div class="panel-eyebrow">Direct Interaction</div>
                            <h3>Agent Chat</h3>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <!-- Dropdown "minimal options" removed as per request -->
                        </div>
                    </div>

                    <div class="chat-rail"
                        style="flex: 1; display: flex; flex-direction: column; padding: 0 12px 12px 12px; overflow: hidden;">
                        <div class="chat-messages inline" id="chat-messages"
                            style="flex: 1; overflow-y: auto; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; padding: 8px; margin-bottom: 8px; background: rgba(0,0,0,0.2);">
                        </div>
                        <div class="chat-input-area inline" style="display:flex; flex-direction:column; gap:8px;">
                            <input type="text" class="chat-input" id="chat-input"
                                style="width:100%; box-sizing:border-box;" placeholder="Message HOPE..."
                                aria-label="Chat message input" onkeypress="if(event.key==='Enter') sendChatMessage()">
                            <div style="display:flex; gap:8px;">
                                <button class="chat-send-btn btn primary" id="chat-send" onclick="sendChatMessage()"
                                    style="flex:1;">Send</button>
                                <button class="btn ghost tight" onclick="window.clearChatSession()" title="Reset conversation history">Clear Thread</button>
                                <button class="rail-btn" id="chat-mic" type="button" title="Push-to-talk">üéôÔ∏è</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <div class="col-resizer" data-resize="left"></div>

            <!-- CENTER COLUMN -->
            <main class="column center-column resizable" data-column="center">
                <!-- DOCS VIEW PANEL -->
                <div class="panel docs-view" style="display:none;">
                    <div class="panel-header">
                        <div>
                            <div class="panel-eyebrow">Documentation</div>
                            <h2>Training the Seed Model</h2>
                            <p class="panel-subtitle">Human & HOPE Reading: Fast, Mid, and Slow Loops.</p>
                        </div>
                    </div>
                    <div class="task-description" style="margin-bottom: 20px;">
                        The <strong>Pi SSM Seed Model</strong> aligns with the HOPE architecture (Fast/Mid/Slow).
                        Reflexes run on Pi CPU (liquid/RNN) using <code>Local Sanity</code>, skill sequencing processes
                        locally, and long-horizon distillation happens in the cloud (TPU).
                    </div>
                    <!-- shortened for brevity if possible, keeping original content -->
                    <h3 style="margin-top:16px; margin-bottom:8px; color:#fff;">Runbook: Pi5 to Cloud to OTA</h3>
                    <!-- ... content ... -->
                    <!-- Re-inserting the existing Docs content briefly for context match if I replace it, 
                         but I should just insert the NEW panel before the existing panels for safety. -->

                    <!-- ... (keeping existing docs content) ... -->
                    <div class="step-list">
                        <!-- (abbreviated content match) -->
                        <div class="step-item">
                            <div class="step-number">1</div>
                            <div class="step-content"><strong>Hardware & Data Capture</strong>
                                <p>Validate hardware (<code>pi5_hardware_validation</code>). Capture 16+ clean episodes
                                    (RGB-D + Actions) using Manual Teleop or Companion App.</p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-number">2</div>
                            <div class="step-content"><strong>Local Sanity Training</strong>
                                <p>Run JAX sanity check on Pi CPU to verify data shapes and finite loss.<br /><code
                                        style="font-size:0.85em; background:rgba(0,0,0,0.3); padding:2px;">python -m continuonbrain.jax_models.train.local_sanity_check</code>
                                </p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-number">3</div>
                            <div class="step-content"><strong>Cloud TPU Distillation</strong>
                                <p>Upload TFRecords to GCS. Run <code>tpu_train</code> job (v5e) to distill the seed
                                    model.</p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-number">4</div>
                            <div class="step-content"><strong>OTA Deployment</strong>
                                <p>Export signed edge bundle. Deploy via OTA. Verify control loop latency &lt;100ms.</p>
                            </div>
                        </div>
                    </div>
                    <h3 style="margin-top:24px; margin-bottom:8px; color:#fff;">Success Criteria</h3>
                    <ul style="color:#a0aec0; padding-left:20px; line-height:1.6; margin-top:0;">
                        <li><strong>Data:</strong> Timestamp skew &le; 5ms, schema validation passes.</li>
                        <li><strong>Training:</strong> No critical resource alerts, loss decreases.</li>
                        <li><strong>Artifact:</strong> Bundle signed, includes safety manifest.</li>
                        <li><strong>Rollback:</strong> Fallback path preserved on-device.</li>
                    </ul>
                </div>

                <!-- SETTINGS VIEW PANEL -->
                <div class="panel settings-view" style="display:none;">
                    <div class="panel-header">
                        <div>
                            <div class="panel-eyebrow">Configuration</div>
                            <h2>Runtime Settings</h2>
                            <p class="panel-subtitle">Manage training context, chat persona, and safety gates.</p>
                        </div>
                    </div>

                    <form id="settings-form-inline" style="margin-top:20px;">
                        <div class="settings-grid" style="display:grid; grid-template-columns: 1fr; gap:20px;">
                            <div class="settings-card">
                                <h4 style="margin:0 0 12px 0;">Runtime Context</h4>
                                <div class="settings-row" style="display:flex; flex-wrap:wrap; gap:24px;">
                                    <label style="display:flex; gap:8px; align-items:center; cursor:pointer;">
                                        <input type="radio" name="runtime-context-inline" value="training">
                                        <div>
                                            <strong style="display:block;">Training</strong>
                                            <span style="font-size:0.85em; color:var(--muted);">Focus on learning
                                                loops.</span>
                                        </div>
                                    </label>
                                    <label style="display:flex; gap:8px; align-items:center; cursor:pointer;">
                                        <input type="radio" name="runtime-context-inline" value="inference">
                                        <div>
                                            <strong style="display:block;">Inference</strong>
                                            <span style="font-size:0.85em; color:var(--muted);">Optimize for
                                                speed.</span>
                                        </div>
                                    </label>
                                    <label style="display:flex; gap:8px; align-items:center; cursor:pointer;">
                                        <input type="radio" name="runtime-context-inline" value="hybrid" checked>
                                        <div>
                                            <strong style="display:block;">Hybrid</strong>
                                            <span style="font-size:0.85em; color:var(--muted);">Balanced
                                                (Default).</span>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div class="settings-card">
                                <h4 style="margin:0 0 12px 0;">Chat & Persona</h4>
                                <div
                                    style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:16px;">
                                    <label style="display:block;">
                                        <span
                                            style="display:block; font-size:12px; color:var(--muted); margin-bottom:4px;">Persona
                                            Role</span>
                                        <input type="text" id="chat-persona-inline" class="input-compact"
                                            value="operator" style="width:100%;">
                                    </label>
                                    <label style="display:block;">
                                        <span
                                            style="display:block; font-size:12px; color:var(--muted); margin-bottom:4px;">Temperature
                                            (0.0 - 1.0)</span>
                                        <input type="number" id="chat-temperature-inline" class="input-compact"
                                            value="0.35" step="0.05" min="0" max="1" style="width:100%;">
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="modal-actions" style="justify-content: flex-start; margin-top: 24px;">
                            <button type="submit" class="btn primary">Save Changes</button>
                            <span id="settings-status-inline"
                                style="margin-left: 12px; color: var(--muted); font-size: 13px;"></span>
                        </div>
                    </form>
                </div>

                <div class="panel standard-view">
                    <div class="panel-header">
                        <div>
                            <div class="panel-eyebrow">Live State</div>
                            <h2>Robot Status & Health</h2>
                            <p class="panel-subtitle">Motion, recording, gates, hardware, and loop telemetry.</p>
                        </div>
                    </div>
                    <div class="status-deck">
                        <div class="status-card">
                            <div class="status-label">Robot Mode</div>
                            <div class="status-value" id="mode-card">Loading‚Ä¶</div>
                        </div>
                        <div class="status-card">
                            <div class="status-label">Recording</div>
                            <div class="status-value" id="recording-card">No</div>
                        </div>
                        <div class="status-card">
                            <div class="status-label">Motion Allowed</div>
                            <div class="status-value" id="motion-card">No</div>
                        </div>
                        <div class="status-card">
                            <div class="status-label">Battery / Power</div>
                            <div class="status-value" id="battery-status">--</div>
                        </div>
                        <div class="status-card">
                            <div class="status-label">CPU / Memory</div>
                            <div class="status-value" id="cpu-mem-status">--</div>
                        </div>
                    </div>
                    <div class="status-deck">
                        <div class="status-card">
                            <div class="status-label">Wave / Particle</div>
                            <div class="gauge-bar">
                                <div class="gauge-fill" id="wave-meter"></div>
                            </div>
                            <div class="loop-meta" id="wave-value">--</div>
                        </div>
                        <div class="status-card">
                            <div class="status-label">HOPE Loops</div>
                            <div class="loop-meta" id="hope-fast">--</div>
                            <div class="loop-meta" id="hope-mid">--</div>
                            <div class="loop-meta" id="hope-slow">--</div>
                        </div>
                        <div class="status-card">
                            <div class="status-label">CMS Balance</div>
                            <div class="loop-meta" id="cms-ratio">--</div>
                            <div class="loop-meta" id="cms-buffer">--</div>
                        </div>
                    </div>
                    <div class="sensor-grid" id="hardware-status">
                        <div class="status-item">
                            <span class="status-label">Loading sensors...</span>
                        </div>
                    </div>
                </div>

                <div class="panel owner-only">
                    <div class="panel-header">
                        <div>
                            <div class="panel-eyebrow">Task Library</div>
                            <h2>Autonomy Tasks</h2>
                            <p class="panel-subtitle">Eligibility, gating, and handoff to robot.</p>
                        </div>
                        <div class="selected-task-pill" id="current-task-pill">No task selected</div>
                    </div>
                    <div class="task-group-controls">
                        <div class="segmented-controls" id="task-group-segments"></div>
                        <input id="task-filter-input" class="input-compact" type="search" placeholder="Filter tasks..."
                            oninput="window.filterTaskText(this.value)">
                    </div>
                    <div class="task-groups-accordion" id="task-groups">
                        <div class="status-item">
                            <span class="status-label">Loading tasks...</span>
                        </div>
                    </div>
                </div>

                <div class="panel owner-only">
                    <div class="panel-header">
                        <div>
                            <div class="panel-eyebrow">Skill Library</div>
                            <h2>Reusable Skills</h2>
                            <p class="panel-subtitle">Capabilities, publishers, and eligibility.</p>
                        </div>
                        <div class="segmented-controls tight">
                            <input id="skill-filter-input" class="input-compact" type="search"
                                placeholder="Filter skills..." oninput="window.filterSkillText(this.value)">
                            <button class="ghost" onclick="window.fetchSkillLibrary()">Refresh</button>
                        </div>
                    </div>
                    <div class="panel-subtitle mt-8" id="pinned-skill-pill">Pinned skill: none</div>
                    <div id="skill-groups" class="skill-grid">
                        <div class="status-item">
                            <span class="status-label">Loading skills...</span>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <div>
                            <div class="panel-eyebrow">Skill Curriculum</div>
                            <h2>Autonomous Lessons</h2>
                            <p class="panel-subtitle">Verify skill acquisition.</p>
                        </div>
                    </div>
                    <div id="lesson-list" class="stack-list">
                        <div class="stack-item"><span class="stack-meta">Loading curriculum...</span></div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <div>
                            <div class="panel-eyebrow">API Explorer</div>
                            <h2>Live Endpoints</h2>
                            <p class="panel-subtitle">Call server APIs directly to verify state.</p>
                        </div>
                    </div>
                    <div class="api-grid" id="api-explorer">
                        <div class="api-card">
                            <div class="api-meta">GET /api/status</div>
                            <button onclick="window.updateStatus()">Fetch</button>
                        </div>
                        <div class="api-card">
                            <div class="api-meta">GET /api/loops</div>
                            <button onclick="window.pollLoopHealth()">Fetch</button>
                        </div>
                        <div class="api-card">
                            <div class="api-meta">GET /api/tasks?include_ineligible=true</div>
                            <button onclick="window.fetchTaskLibrary()">Fetch</button>
                        </div>
                        <div class="api-card">
                            <div class="api-meta">GET /api/skills?include_ineligible=true</div>
                            <button onclick="window.fetchSkillLibrary()">Fetch</button>
                        </div>
                        <div class="api-card">
                            <div class="api-meta">POST /api/safety/hold</div>
                            <button onclick="window.triggerSafetyHold()">Trigger</button>
                        </div>
                        <div class="api-card">
                            <div class="api-meta">POST /api/safety/reset</div>
                            <button onclick="window.resetSafetyGates()">Trigger</button>
                        </div>
                    </div>
                </div>

                <!-- NEW: 4D Brain Visualization Panel -->
                <div class="panel research-only" style="display:none;">
                    <div class="panel-header">
                        <div>
                            <div class="panel-eyebrow">4D brain visualization</div>
                            <h2>HOPE Brain (3D + time)</h2>
                            <p class="panel-subtitle">A ‚Äú4D‚Äù view: 3D structure + a time slider that scrubs recent live
                                metrics onto the graph.</p>
                        </div>
                    </div>
                    <div class="panel-content">
                        <div class="panel-ghost">
                            <div class="mode-pills"
                                style="margin-bottom:10px; display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
                                <div class="panel-subtitle" style="margin:0; margin-right:10px;">Layout</div>
                                <button class="tool-btn current" id="brain-layout-graph" type="button"
                                    style="padding:4px 10px; font-size:12px;">Graph</button>
                                <button class="tool-btn" id="brain-layout-columnar" type="button"
                                    style="padding:4px 10px; font-size:12px;">Columnar</button>
                                <button class="tool-btn" id="brain-layout-hybrid" type="button"
                                    style="padding:4px 10px; font-size:12px;">Hybrid</button>
                                <span style="flex:1;"></span>
                                <div class="panel-subtitle" style="margin:0; margin-right:10px;">Overlay</div>
                                <select id="brain-overlay" class="input-compact" style="width:160px;">
                                    <option value="all" selected>All (default)</option>
                                    <option value="control_loop">Control loop</option>
                                    <option value="wavecore">WaveCore loss</option>
                                    <option value="tool_search">Tool search</option>
                                    <option value="hope_eval">HOPE eval</option>
                                </select>
                                <div class="panel-subtitle" style="margin:0; margin-left:10px; margin-right:6px;">Flow
                                </div>
                                <button class="tool-btn current" id="brain-flow-toggle" type="button"
                                    style="padding:4px 10px; font-size:12px;">Hide Flow</button>
                            </div>
                            <div class="metric-row" style="margin-bottom:10px;">
                                <div class="metric-label"
                                    style="font-size:12px; color:var(--muted); margin-bottom:4px;">Time Scrubbing</div>
                                <div class="metric-value" style="display:flex; gap:10px; align-items:center;">
                                    <input id="brain-viz-time" type="range" min="0" max="100" value="100"
                                        style="width:100%; cursor:pointer;">
                                    <span class="stack-meta" id="brain-viz-time-label"
                                        style="min-width:100px; text-align:right;">latest</span>
                                </div>
                            </div>
                            <div class="panel-ghost brain-strip-panel"
                                style="margin-bottom:12px; padding:10px; background:rgba(0,0,0,0.2);">
                                <div class="brain-strip-header"
                                    style="display:flex; justify-content:space-between; margin-bottom:6px;">
                                    <div>
                                        <div class="panel-eyebrow">CMS cross-section</div>
                                    </div>
                                    <div class="brain-strip-legend"
                                        style="display:flex; gap:8px; font-size:11px; color:var(--muted);">
                                        <span style="color:#ff8c42;">‚óè Fast</span>
                                        <span style="color:#8a52ff;">‚óè Mid</span>
                                        <span style="color:#67d3ff;">‚óè Slow</span>
                                    </div>
                                </div>
                                <div class="brain-strip-canvas-wrap"
                                    style="position:relative; height:160px; overflow:hidden; border:1px solid rgba(255,255,255,0.05); border-radius:8px;">
                                    <canvas id="brain-viz-strip" class="brain-strip-canvas" height="160"
                                        style="width:100%; height:100%;"></canvas>
                                    <div id="brain-viz-strip-fallback" class="stack-meta brain-strip-fallback"
                                        style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center;">
                                        Cross-section unavailable</div>
                                </div>
                            </div>
                            <div id="brain-viz-container"
                                style="height:440px; border-radius:14px; border:1px solid rgba(255,255,255,0.12); background: rgba(0,0,0,0.12); overflow:hidden; position:relative;">
                                <div id="brain-viz-fallback" class="stack-meta"
                                    style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; padding:18px; text-align:center;">
                                    Loading 3D brain‚Ä¶
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel research-only">
                    <div class="panel-header">
                        <div>
                            <div class="panel-eyebrow">Reality vs. Dream</div>
                            <h2>World-Model Proof Harness</h2>
                            <p class="panel-subtitle">Visual tokens, temporal resolution, compute budget, and surprise
                                tracking.</p>
                        </div>
                        <div class="proof-actions">
                            <div class="chip" id="surprise-counter-chip">Surprises: 0</div>
                            <button class="ghost" type="button" onclick="window.logRealitySurprise()">Log
                                surprise</button>
                        </div>
                    </div>
                    <div class="dream-grid">
                        <div class="proof-card">
                            <div class="panel-eyebrow">Visual token rate</div>
                            <div class="proof-value" id="visual-token-rate">‚Äî</div>
                            <div class="proof-meta">Estimated tokens/sec from vision ‚Üí text</div>
                        </div>
                        <div class="proof-card">
                            <div class="panel-eyebrow">Temporal resolution</div>
                            <div class="proof-value" id="temporal-resolution">‚Äî</div>
                            <div class="proof-meta">Milliseconds per frame/loop</div>
                        </div>
                        <div class="proof-card">
                            <div class="panel-eyebrow">Dream latency</div>
                            <div class="proof-value" id="dream-latency">‚Äî</div>
                            <div class="proof-meta">LLM prediction latency (ms)</div>
                        </div>
                        <div class="proof-card">
                            <div class="panel-eyebrow">Compute budget</div>
                            <div class="proof-value" id="compute-budget">‚Äî</div>
                            <div class="proof-meta">Accel vs. CPU/JAX fallback</div>
                        </div>
                        <div class="proof-card">
                            <div class="panel-eyebrow">Reality delta</div>
                            <div class="proof-value" id="reality-drift">Awaiting reality check</div>
                            <div class="proof-meta">Prediction vs. observed outcome</div>
                        </div>
                        <div class="proof-card">
                            <div class="panel-eyebrow">Context updates</div>
                            <div class="proof-value" id="context-updates">No surprises yet</div>
                            <div class="proof-meta">How the world model adapted</div>
                        </div>
                    </div>
                    <div class="proof-checklist">
                        <div class="proof-step">
                            <div class="proof-title">NPU ‚Üí Tokens</div>
                            <div class="proof-detail" id="proof-vision-line">Waiting for frames‚Ä¶</div>
                        </div>
                        <div class="proof-step">
                            <div class="proof-title">LLM Prediction</div>
                            <div class="proof-detail" id="proof-dream-line">Awaiting model stack‚Ä¶</div>
                        </div>
                        <div class="proof-step">
                            <div class="proof-title">Reality Check</div>
                            <div class="proof-detail" id="proof-reality-line">No observation yet</div>
                        </div>
                        <div class="proof-step">
                            <div class="proof-title">Context Update</div>
                            <div class="proof-detail" id="proof-context-line">No updates yet</div>
                        </div>
                    </div>
                    <div class="proof-log" id="surprise-log"></div>
                </div>

                <!-- NEW: Training & Imagination Panel -->
                <div class="panel standard-view">
                    <div class="panel-header">
                        <div>
                            <div class="panel-eyebrow">JAX World Model</div>
                            <h2>Training & Imagination</h2>
                            <p class="panel-subtitle">On-device learning loop and symbolic planning.</p>
                        </div>
                        <div class="status-badge" id="training-status">Idle</div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="train-step">0</div>
                            <div class="stat-label">Global Step</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="train-loss">--</div>
                            <div class="stat-label">Current Loss</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="imagination-depth">0</div>
                            <div class="stat-label">Search Depth</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="plan-score">--</div>
                            <div class="stat-label">Plan Score</div>
                        </div>
                    </div>

                    <div class="control-row" style="margin-top: 16px; display: flex; gap: 12px;">
                        <button class="rail-btn primary" onclick="startJaxTraining()" style="flex: 1;">
                            ‚ö° Train (JAX/Wiki/VLM)
                        </button>
                        <button class="rail-btn" onclick="startSymbolicSearch()" style="flex: 1;">
                            üîÆ Imagine/Search
                        </button>
                    </div>

                    <div class="proof-log" id="training-log" style="height: 120px; margin-top: 12px;">
                        <div class="log-entry system">System ready. Load datasets to begin.</div>
                    </div>
                </div>

                <div class="panel research-only">
                    <div class="panel-header">
                        <div>
                            <div class="panel-eyebrow">AGI Readiness</div>
                            <h2>Capability Matrix</h2>
                            <p class="panel-subtitle">What‚Äôs present, what‚Äôs missing, and why this is not AGI.</p>
                        </div>
                    </div>
                    <div class="agi-grid" id="agi-matrix">
                        <div class="agi-card success">
                            <div class="agi-title">Embodiment</div>
                            <div class="agi-detail">Drivetrain + manipulator + vision</div>
                        </div>
                        <div class="agi-card warning">
                            <div class="agi-title">Continual Learning</div>
                            <div class="agi-detail">Local training hooks; limited autonomy</div>
                        </div>
                        <div class="agi-card danger">
                            <div class="agi-title">General Reasoning</div>
                            <div class="agi-detail">No verified AGI; bounded task agents</div>
                        </div>
                        <div class="agi-card warning">
                            <div class="agi-title">Safety & Alignment</div>
                            <div class="agi-detail">Gates + supervision required; no self-cert</div>
                        </div>
                        <div class="agi-card neutral">
                            <div class="agi-title">Tool Use</div>
                            <div class="agi-detail">Sub-agents + toolchain; manual review</div>
                        </div>
                        <div class="agi-card neutral">
                            <div class="agi-title">Model Stack</div>
                            <div class="agi-detail" id="agi-model-stack">HOPE ‚Üí Gemma fallback</div>
                        </div>
                    </div>
                </div>

                <div id="status-message" class="inline-status hidden"></div>
            </main>

            <div class="col-resizer" data-resize="right"></div>

            <!-- RIGHT COLUMN -->
            <aside class="column right-column resizable" data-column="right">
                <div class="panel">
                    <div class="panel-header">
                        <div>
                            <div class="panel-eyebrow">Continuon AI Agent Manager</div>
                            <h2>Threads & Guidance</h2>
                            <p class="panel-subtitle">Inline rail; no overlays for Flutter embed.</p>
                            <div id="persona-badge" class="persona-badge">Persona: default</div>
                        </div>
                        <div class="human-toggle" id="human-toggle" onclick="toggleHumanMode()">
                            <span>Human mode</span>
                            <strong id="human-toggle-state">Off</strong>
                        </div>
                        <div class="human-toggle" id="teacher-toggle" onclick="toggleTeacherMode()"
                            style="margin-top: 8px;">
                            <span>Teacher Mode</span>
                            <strong id="teacher-toggle-state">Off</strong>
                        </div>
                    </div>

                    <div class="rail-actions">
                        <button class="rail-btn primary" onclick="resumeAgents()">‚ñ∂Ô∏è Resume agents</button>
                        <button class="rail-btn" onclick="pauseAgents()">‚è∏Ô∏è Pause agents</button>
                        <button class="rail-btn" onclick="reviewLearning()">üìí Review learning</button>
                    </div>

                    <div class="panel-ghost">
                        <div class="panel-eyebrow">Active Agents</div>
                        <div class="agent-thread-list" id="agent-thread-list"></div>
                    </div>

                    <div class="panel-ghost">
                        <div class="panel-eyebrow">Cognitive Feed</div>
                        <div class="thought-stream" id="thought-stream" style="font-family:monospace; font-size:11px; max-height:150px; overflow-y:auto; color:var(--text);">
                            <div class="thought-item" style="color:var(--muted); font-style:italic;">Waiting for thoughts...</div>
                        </div>
                    </div>

                    <div class="panel-ghost">
                        <div class="panel-eyebrow">Tool Audit</div>
                        <div class="tool-audit-list" id="tool-audit-list" style="font-family:monospace; font-size:11px; max-height:150px; overflow-y:auto; color:var(--text);">
                            <div class="stack-item"><span class="stack-meta">No tools used yet</span></div>
                        </div>
                    </div>

                    <div class="panel-ghost">
                        <div class="panel-eyebrow">Model Stack & Fallbacks</div>
                        <div class="stack-list" id="model-stack-list"></div>
                    </div>

                    <div class="panel-ghost">
                        <div class="panel-eyebrow">Sub-agents & Tools</div>
                        <div class="stack-list" id="toolchain-list"></div>
                    </div>

                    <div class="panel-ghost">
                        <div class="panel-eyebrow">Training & Memories</div>
                        <div class="stack-list" id="training-memory-list"></div>
                    </div>

                    <div class="panel-ghost">
                        <div class="panel-eyebrow">Robot Mode Self-Learning</div>
                        <div class="milestone-list" id="learning-milestones"></div>
                    </div>

                    <div class="panel-ghost">
                        <div class="panel-eyebrow">Recent Learning Events</div>
                        <div class="learning-list" id="learning-events"></div>
                    </div>

                    <div class="panel-ghost">
                        <div class="panel-eyebrow">Context</div>
                        <p style="color:var(--muted); font-size:0.9em;">Chat moved to left Command Deck.</p>
                    </div>
                </div>
            </aside>
        </div>

        <!-- PLANNING VIEW PANEL (New) -->
        <div class="panel planning-view" style="display:none;">
            <div class="panel-header">
                <div>
                    <div class="panel-eyebrow">Strategic Planning</div>
                    <h2>Task & Motion Planning</h2>
                    <p class="panel-subtitle">Create, simulate, and execute high-level plans.</p>
                </div>
            </div>
            <!-- Moved Planning Tools Here -->
            <div id="planning-tools-container" style="padding:20px;">
                <!-- Content injected/managed by ui_logic.js if needed, or static forms here -->
                <div class="settings-grid">
                    <div class="settings-card">
                        <h4>Arm Planner</h4>
                        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-bottom:12px;">
                            <input type="number" id="plan-goal-j0" placeholder="J0" step="0.1">
                            <input type="number" id="plan-goal-j1" placeholder="J1" step="0.1">
                            <input type="number" id="plan-goal-j2" placeholder="J2" step="0.1">
                            <input type="number" id="plan-goal-j3" placeholder="J3" step="0.1">
                            <input type="number" id="plan-goal-j4" placeholder="J4" step="0.1">
                            <input type="number" id="plan-goal-j5" placeholder="J5" step="0.1">
                        </div>
                        <div style="display:flex; gap:12px;">
                            <button class="btn primary" onclick="window.runArmPlanner()">Plan Motion</button>
                            <label style="display:flex; align-items:center; gap:8px;">
                                <input type="checkbox" id="plan-execute"> Execute
                            </label>
                        </div>
                        <pre id="plan-output"
                            style="margin-top:12px; background:rgba(0,0,0,0.3); padding:8px; border-radius:4px; max-height:200px; overflow:auto;">(No plan)</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- MANUAL CONTROL VIEW PANEL (New) -->
        <div class="panel manual-view" style="display:none;">
            <div class="panel-header">
                <div>
                    <div class="panel-eyebrow">Direct Control</div>
                    <h2>Manual Teleoperation</h2>
                    <p class="panel-subtitle">Keyboard and joystick control override.</p>
                </div>
            </div>
            <div class="settings-grid" style="padding:20px;">
                <div class="settings-card">
                    <h4 style="margin-bottom:16px;">Keyboard Drive (WASD)</h4>
                    <div style="display:flex; gap:12px; justify-content:center; margin-bottom:20px;">
                        <div class="key-cap">W</div>
                    </div>
                    <div style="display:flex; gap:12px; justify-content:center;">
                        <div class="key-cap">A</div>
                        <div class="key-cap">S</div>
                        <div class="key-cap">D</div>
                    </div>
                    <div style="text-align:center; margin-top:16px; color:var(--muted);">
                        Click here to focus for keyboard control
                    </div>
                </div>
            </div>
        </div>
        </main>
    </div>
    </div>

    <div class="modal-backdrop" id="settings-backdrop"></div>
    <div class="settings-modal" id="settings-modal" aria-hidden="true" role="dialog" aria-labelledby="settings-title">
        <div class="modal-card">
            <div class="modal-header">
                <h3 class="modal-title" id="settings-title">Runtime Settings</h3>
                <button class="close-btn" type="button" onclick="closeSettingsModal()">‚úï</button>
            </div>

            <form id="settings-form">
                <div class="settings-grid">
                    <div class="settings-card" style="grid-column: span 3;">
                        <h4>Runtime Context</h4>
                        <p style="color:var(--muted); font-size:0.9em; margin-bottom:16px;">Select the operational mode
                            for the brain.</p>

                        <div class="settings-row" style="justify-content:flex-start; gap:24px;">
                            <label style="display:flex; gap:8px; align-items:center; cursor:pointer;">
                                <input type="radio" name="runtime-context" value="training">
                                <div>
                                    <strong style="display:block;">Training</strong>
                                    <span style="font-size:0.85em; color:var(--muted);">Focus on learning loops.</span>
                                </div>
                            </label>
                            <label style="display:flex; gap:8px; align-items:center; cursor:pointer;">
                                <input type="radio" name="runtime-context" value="inference">
                                <div>
                                    <strong style="display:block;">Inference</strong>
                                    <span style="font-size:0.85em; color:var(--muted);">Optimize for
                                        speed/execution.</span>
                                </div>
                            </label>
                            <label style="display:flex; gap:8px; align-items:center; cursor:pointer;">
                                <input type="radio" name="runtime-context" value="hybrid" checked>
                                <div>
                                    <strong style="display:block;">Hybrid</strong>
                                    <span style="font-size:0.85em; color:var(--muted);">Balanced operation
                                        (Default).</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Hidden legacy settings for now -->
                    <div style="display:none;">
                        <input type="number" id="telemetry-rate" value="2.0">
                        <input type="text" id="chat-persona" value="operator">
                        <input type="number" id="chat-temperature" value="0.35">
                        <input type="checkbox" id="settings-allow-motion">
                        <input type="checkbox" id="settings-record-episodes">
                        <input type="checkbox" id="settings-require-supervision">
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn" onclick="closeSettingsModal()">Cancel</button>
                    <button type="submit" class="btn primary">Save</button>
                </div>
                <div class="modal-status" id="settings-status">Changes are persisted to your config directory.</div>
            </form>
        </div>
    </div>

    <!-- PAIRING MODAL -->
    <div class="modal-backdrop" id="pairing-backdrop"></div>
    <div class="settings-modal" id="pairing-modal" aria-hidden="true" role="dialog">
        <div class="modal-card" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title">Pair Mobile App</h3>
                <button class="close-btn" type="button" onclick="window.closePairingModal()">‚úï</button>
            </div>
            <div style="text-align: center; padding: 20px;">
                <div id="pairing-loading" style="color: var(--muted);">Generating session...</div>
                <div id="pairing-content" style="display:none;">
                    <p style="margin-bottom: 20px; color: var(--muted);">Scan with Continuon App</p>
                    <div style="background: white; padding: 10px; display: inline-block; border-radius: 8px;">
                        <img id="pairing-qr" src="" alt="Pairing QR" width="200" height="200" style="display: block;">
                    </div>
                    <div style="margin-top: 20px;">
                        <div
                            style="font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: 1px;">
                            Confirm Code</div>
                        <div id="pairing-code"
                            style="font-size: 32px; font-weight: bold; font-family: monospace; color: var(--accent); letter-spacing: 4px; margin-top: 5px;">
                            --- ---</div>
                    </div>
                    <p
                        style="margin-top: 20px; font-size: 12px; color: var(--muted); max-width: 300px; margin-left: auto; margin-right: auto; line-height: 1.4;">
                        If scanning fails, ensure phone is on same Wi-Fi: <br>
                        <span id="pairing-url-text"
                            style="color: var(--text); user-select: all; text-decoration: underline;"></span>
                    </p>
                </div>
                <div id="pairing-error" style="color: var(--danger); display: none;"></div>
            </div>
        </div>
    </div>

    <script src="/static/client.js"></script>
    <script src="/static/ui_core.js"></script>
    <script src="/static/ui_owner.js"></script>
    <script src="/static/ui_research.js"></script>
    <script src="/static/ui_docs.js"></script>
    <script type="module">
        // Load Three.js brain visualization (best-effort; falls back gracefully).
        try {
            await import('/static/brain-viz.js');
        } catch (e) {
            const el = document.getElementById('brain-viz-fallback');
            if (el) el.textContent = '3D brain view unavailable (module load failed). Check network/CSP or use the metrics cards above.';
            console.warn('brain-viz load failed', e);
        }
    </script>
</body>

</html>