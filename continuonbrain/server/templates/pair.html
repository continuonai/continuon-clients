<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pair phone</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:#0b1020; color:#e8f0ff; margin:0; padding:18px; }
    .card { max-width:520px; margin:0 auto; background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.10); border-radius:16px; padding:16px; }
    h1 { font-size:18px; margin:0 0 8px 0; }
    .muted { color: rgba(255,255,255,0.72); font-size:13px; line-height:1.35; }
    label { display:block; margin-top:12px; font-size:13px; color: rgba(255,255,255,0.8); }
    input { width:100%; padding:10px 12px; margin-top:6px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background:rgba(255,255,255,0.06); color:#e8f0ff; font-size:14px; }
    button { margin-top:14px; width:100%; padding:12px; border:0; border-radius:12px; font-weight:800; background: linear-gradient(135deg, #4f9dff, #7ad7ff); color:#0b1020; }
    .status { margin-top:12px; font-size:13px; white-space:pre-wrap; }
    code { background:rgba(0,0,0,0.25); padding:2px 6px; border-radius:8px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Pair this phone with the robot</h1>
    <div class="muted">
      This pairing is local-network only. Enter the 6-digit code shown on the robot UI.
      {% if creator %}<div style="margin-top:6px;">Creator label: <code>{{ creator }}</code></div>{% endif %}
    </div>

    <label>Owner ID (who is claiming this robot)</label>
    <input id="owner-id" placeholder="e.g. Craig Merry" value="{{ creator }}" />

    <label>Confirm code (6 digits)</label>
    <input id="confirm-code" inputmode="numeric" pattern="[0-9]*" placeholder="123456" />

    <button id="pair-btn" type="button">Claim robot</button>
    <div id="status" class="status muted"></div>
  </div>

  <script>
    (function () {
      const token = "{{ token }}";
      const statusEl = document.getElementById('status');
      const btn = document.getElementById('pair-btn');
      btn.addEventListener('click', async () => {
        const ownerId = (document.getElementById('owner-id').value || '').trim();
        const confirmCode = (document.getElementById('confirm-code').value || '').trim();
        statusEl.textContent = 'Pairing...';
        try {
          const res = await fetch('/api/ownership/pair/confirm', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token, confirm_code: confirmCode, owner_id: ownerId })
          });
          const data = await res.json();
          if (!res.ok || data.status !== 'ok') throw new Error(data.message || 'pair failed');
          statusEl.textContent = 'Paired successfully. You can close this page.';
          btn.disabled = true;
        } catch (e) {
          statusEl.textContent = 'Error: ' + (e && e.message ? e.message : String(e));
        }
      });
    })();
  </script>
</body>
</html>


