{% extends "base_v2.html" %}

{% block title %}Agent Console - Continuon Brain{% endblock %}

{% block extra_styles %}
/* Hide the persistent agent rail on this page - we have an enhanced version */
.agent-rail {
    display: none !important;
}

/* Adjust the app shell grid to not reserve space for agent rail */
.app-shell {
    grid-template-columns: var(--nav-width) 1fr !important;
}

/* Agent Page Styles */
.agent-layout {
    display: grid;
    grid-template-columns: 1fr 360px;
    gap: 20px;
    min-height: calc(100vh - var(--header-height) - var(--footer-height) - 80px);
}

/* Agent Dashboard */
.agent-dashboard {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

/* Agent Status Panel */
.agent-status-panel {
    background: linear-gradient(135deg, var(--bg-surface) 0%, rgba(99, 102, 241, 0.08) 100%);
    border: 1px solid var(--accent-primary);
    border-radius: 12px;
    padding: 24px;
}

.agent-identity {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 24px;
}

.agent-avatar-large {
    width: 80px;
    height: 80px;
    border-radius: 20px;
    background: var(--accent-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
}

.agent-name-section h2 {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 4px;
}

.agent-subtitle {
    color: var(--text-muted);
    font-size: 13px;
}

.agent-badges {
    display: flex;
    gap: 8px;
    margin-top: 8px;
}

.agent-badge {
    padding: 4px 10px;
    background: var(--bg-glass);
    border: 1px solid var(--border-subtle);
    border-radius: 12px;
    font-size: 11px;
    color: var(--text-secondary);
}

.agent-badge.active {
    background: var(--accent-success-dim);
    border-color: var(--accent-success);
    color: var(--accent-success);
}

.agent-metrics-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
}

.agent-metric {
    background: var(--bg-elevated);
    border-radius: 10px;
    padding: 16px;
    text-align: center;
}

.agent-metric-value {
    font-family: var(--font-mono);
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 4px;
}

.agent-metric-label {
    font-size: 11px;
    color: var(--text-muted);
    text-transform: uppercase;
}

/* Current Task Panel */
.current-task-panel {
    background: var(--bg-surface);
    border: 1px solid var(--border-subtle);
    border-radius: 12px;
    overflow: hidden;
}

.task-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    background: var(--bg-elevated);
    border-bottom: 1px solid var(--border-subtle);
}

.task-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    font-weight: 600;
}

.task-status {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
}

.task-status.active {
    background: var(--accent-success-dim);
    color: var(--accent-success);
}

.task-status.idle {
    background: var(--bg-glass);
    color: var(--text-muted);
}

.task-status.thinking {
    background: var(--accent-warning-dim);
    color: var(--accent-warning);
    animation: pulse 1.5s infinite;
}

.task-body {
    padding: 20px;
}

.task-description {
    font-size: 14px;
    color: var(--text-secondary);
    margin-bottom: 16px;
}

.task-progress {
    margin-bottom: 16px;
}

.task-progress-bar {
    height: 8px;
    background: var(--bg-elevated);
    border-radius: 4px;
    overflow: hidden;
}

.task-progress-fill {
    height: 100%;
    background: var(--accent-primary);
    border-radius: 4px;
    transition: width 0.3s ease;
}

.task-steps {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.task-step {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 13px;
}

.task-step-icon {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
}

.task-step.complete .task-step-icon {
    background: var(--accent-success-dim);
    color: var(--accent-success);
}

.task-step.active .task-step-icon {
    background: var(--accent-primary-dim);
    color: var(--accent-primary);
}

.task-step.pending .task-step-icon {
    background: var(--bg-elevated);
    color: var(--text-muted);
}

/* Thought Process Panel */
.thought-panel {
    background: var(--bg-surface);
    border: 1px solid var(--border-subtle);
    border-radius: 12px;
    overflow: hidden;
}

.thought-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border-subtle);
}

.thought-title {
    font-size: 14px;
    font-weight: 600;
}

.thought-tabs {
    display: flex;
    gap: 8px;
}

.thought-tab {
    padding: 6px 12px;
    background: transparent;
    border: 1px solid var(--border-subtle);
    border-radius: 6px;
    color: var(--text-muted);
    font-size: 12px;
    cursor: pointer;
    transition: all var(--duration-fast);
}

.thought-tab:hover {
    background: var(--bg-glass);
    color: var(--text-primary);
}

.thought-tab.active {
    background: var(--accent-primary);
    border-color: var(--accent-primary);
    color: white;
}

.thought-body {
    padding: 16px 20px;
    max-height: 300px;
    overflow-y: auto;
}

.thought-stream {
    font-family: var(--font-mono);
    font-size: 12px;
    line-height: 1.6;
    color: var(--text-secondary);
}

.thought-item {
    padding: 8px 0;
    border-bottom: 1px solid var(--border-subtle);
}

.thought-item:last-child {
    border-bottom: none;
}

.thought-timestamp {
    color: var(--text-muted);
    font-size: 10px;
}

.thought-content {
    margin-top: 4px;
}

.thought-type {
    display: inline-block;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 600;
    margin-right: 8px;
}

.thought-type.reasoning { background: var(--accent-info); color: white; }
.thought-type.action { background: var(--accent-success); color: white; }
.thought-type.observation { background: var(--accent-warning); color: black; }
.thought-type.error { background: var(--accent-danger); color: white; }

/* Sub-Agents Panel */
.subagents-panel {
    background: var(--bg-surface);
    border: 1px solid var(--border-subtle);
    border-radius: 12px;
    overflow: hidden;
}

.subagent-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    padding: 16px;
}

.subagent-card {
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    border-radius: 10px;
    padding: 16px;
    cursor: pointer;
    transition: all var(--duration-fast);
}

.subagent-card:hover {
    border-color: var(--accent-primary);
    transform: translateY(-2px);
}

.subagent-card.active {
    border-color: var(--accent-success);
    background: var(--accent-success-dim);
}

.subagent-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
}

.subagent-icon {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    background: var(--bg-glass);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
}

.subagent-name {
    font-size: 13px;
    font-weight: 600;
}

.subagent-status {
    font-size: 11px;
    color: var(--text-muted);
}

.subagent-stats {
    display: flex;
    gap: 12px;
    margin-top: 8px;
    font-size: 11px;
    color: var(--text-muted);
}

/* Chat Panel (sidebar) */
.agent-chat-panel {
    display: flex;
    flex-direction: column;
    background: var(--bg-surface);
    border: 1px solid var(--border-subtle);
    border-radius: 12px;
    overflow: hidden;
    height: calc(100vh - var(--header-height) - var(--footer-height) - 80px);
}

.chat-panel-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    background: var(--bg-elevated);
    border-bottom: 1px solid var(--border-subtle);
}

.chat-panel-title {
    font-size: 14px;
    font-weight: 600;
}

.chat-mode-toggle {
    display: flex;
    gap: 4px;
}

.chat-mode-btn {
    padding: 6px 10px;
    background: transparent;
    border: 1px solid var(--border-subtle);
    border-radius: 6px;
    color: var(--text-muted);
    font-size: 11px;
    cursor: pointer;
    transition: all var(--duration-fast);
}

.chat-mode-btn:hover {
    background: var(--bg-glass);
}

.chat-mode-btn.active {
    background: var(--accent-primary);
    border-color: var(--accent-primary);
    color: white;
}

.chat-messages-panel {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.chat-msg {
    max-width: 90%;
    padding: 10px 14px;
    border-radius: 12px;
    font-size: 13px;
    line-height: 1.5;
}

.chat-msg.user {
    align-self: flex-end;
    background: var(--accent-primary);
    color: white;
    border-bottom-right-radius: 4px;
}

.chat-msg.agent {
    align-self: flex-start;
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    border-bottom-left-radius: 4px;
}

.chat-msg.system {
    align-self: center;
    background: var(--bg-glass);
    color: var(--text-muted);
    font-size: 11px;
    padding: 6px 12px;
}

.chat-input-panel {
    padding: 16px;
    border-top: 1px solid var(--border-subtle);
}

.chat-input-row {
    display: flex;
    gap: 8px;
}

.chat-text-input {
    flex: 1;
    padding: 10px 14px;
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 13px;
    outline: none;
}

.chat-text-input:focus {
    border-color: var(--accent-primary);
}

.chat-send-btn {
    padding: 10px 16px;
    background: var(--accent-primary);
    border: none;
    border-radius: 8px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--duration-fast);
}

.chat-send-btn:hover {
    filter: brightness(1.1);
}

.chat-voice-btn {
    padding: 10px 12px;
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    border-radius: 8px;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 16px;
}

.chat-voice-btn:hover {
    border-color: var(--accent-primary);
    color: var(--accent-primary);
}

/* Quick Actions */
.quick-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    padding: 12px 16px;
    background: var(--bg-elevated);
    border-bottom: 1px solid var(--border-subtle);
}

.quick-action-btn {
    padding: 6px 12px;
    background: var(--bg-glass);
    border: 1px solid var(--border-subtle);
    border-radius: 16px;
    color: var(--text-secondary);
    font-size: 11px;
    cursor: pointer;
    transition: all var(--duration-fast);
}

.quick-action-btn:hover {
    background: var(--bg-glass-hover);
    color: var(--text-primary);
    border-color: var(--accent-primary);
}

/* Memory Context */
.memory-panel {
    background: var(--bg-surface);
    border: 1px solid var(--border-subtle);
    border-radius: 12px;
    overflow: hidden;
}

.memory-items {
    padding: 12px 16px;
    max-height: 200px;
    overflow-y: auto;
}

.memory-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 10px 0;
    border-bottom: 1px solid var(--border-subtle);
    font-size: 12px;
}

.memory-item:last-child {
    border-bottom: none;
}

.memory-icon {
    font-size: 14px;
    margin-top: 2px;
}

.memory-content {
    flex: 1;
}

.memory-text {
    color: var(--text-secondary);
    line-height: 1.4;
}

.memory-meta {
    font-size: 10px;
    color: var(--text-muted);
    margin-top: 4px;
}

@media (max-width: 1200px) {
    .agent-layout {
        grid-template-columns: 1fr;
    }

    .agent-chat-panel {
        height: 400px;
    }

    .agent-metrics-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Agent Console</h1>
    <p class="page-subtitle">Monitor and interact with the HOPE AI agent</p>
    <p class="help-text">View the agent's thought process, manage sub-agents, and communicate via natural language or voice commands.</p>
</div>

<div class="agent-layout">
    <div class="agent-dashboard">
        <!-- Agent Status -->
        <div class="agent-status-panel">
            <div class="agent-identity">
                <div class="agent-avatar-large">ü§ñ</div>
                <div class="agent-name-section">
                    <h2>HOPE Agent</h2>
                    <div class="agent-subtitle">Hierarchical Open-ended Progression Engine</div>
                    <div class="agent-badges">
                        <span class="agent-badge active" id="agent-online-badge">Online</span>
                        <span class="agent-badge" id="agent-learning-badge">Learning</span>
                        <span class="agent-badge" id="agent-autonomous-badge">Autonomous</span>
                    </div>
                </div>
            </div>
            <div class="agent-metrics-grid">
                <div class="agent-metric">
                    <div class="agent-metric-value" id="metric-conversations">42</div>
                    <div class="agent-metric-label">Conversations</div>
                </div>
                <div class="agent-metric">
                    <div class="agent-metric-value" id="metric-tasks">17</div>
                    <div class="agent-metric-label">Tasks Completed</div>
                </div>
                <div class="agent-metric">
                    <div class="agent-metric-value" id="metric-latency">120ms</div>
                    <div class="agent-metric-label">Avg Latency</div>
                </div>
                <div class="agent-metric">
                    <div class="agent-metric-value" id="metric-accuracy">94%</div>
                    <div class="agent-metric-label">Accuracy</div>
                </div>
            </div>
        </div>

        <!-- Current Task -->
        <div class="current-task-panel">
            <div class="task-header">
                <div class="task-title">
                    <span>üìã</span>
                    <span>Current Task</span>
                </div>
                <span class="task-status idle" id="task-status">Idle</span>
            </div>
            <div class="task-body">
                <div class="task-description" id="task-description">
                    No active task. Ask me to do something!
                </div>
                <div class="task-progress" id="task-progress-section" style="display: none;">
                    <div class="task-progress-bar">
                        <div class="task-progress-fill" id="task-progress-bar" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="task-steps" id="task-steps">
                    <!-- Steps populated dynamically -->
                </div>
            </div>
        </div>

        <!-- Thought Process -->
        <div class="thought-panel">
            <div class="thought-header">
                <span class="thought-title">üß† Thought Process</span>
                <div class="thought-tabs">
                    <button class="thought-tab active" data-tab="live" onclick="switchThoughtTab('live')">Live</button>
                    <button class="thought-tab" data-tab="reasoning" onclick="switchThoughtTab('reasoning')">Reasoning</button>
                    <button class="thought-tab" data-tab="actions" onclick="switchThoughtTab('actions')">Actions</button>
                </div>
            </div>
            <div class="thought-body">
                <div class="thought-stream" id="thought-stream">
                    <div class="thought-item">
                        <div class="thought-timestamp">12:34:56</div>
                        <div class="thought-content">
                            <span class="thought-type observation">Observation</span>
                            System initialized. Ready to assist.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sub-Agents -->
        <div class="subagents-panel">
            <div class="task-header">
                <div class="task-title">
                    <span>üë•</span>
                    <span>Sub-Agents</span>
                </div>
            </div>
            <div class="subagent-grid">
                <div class="subagent-card active" data-agent="planner">
                    <div class="subagent-header">
                        <div class="subagent-icon">üìã</div>
                        <div>
                            <div class="subagent-name">Planner</div>
                            <div class="subagent-status">Active</div>
                        </div>
                    </div>
                    <div class="subagent-stats">
                        <span>Tasks: 12</span>
                        <span>Success: 100%</span>
                    </div>
                </div>
                <div class="subagent-card active" data-agent="navigator">
                    <div class="subagent-header">
                        <div class="subagent-icon">üß≠</div>
                        <div>
                            <div class="subagent-name">Navigator</div>
                            <div class="subagent-status">Active</div>
                        </div>
                    </div>
                    <div class="subagent-stats">
                        <span>Routes: 8</span>
                        <span>Success: 95%</span>
                    </div>
                </div>
                <div class="subagent-card" data-agent="safety">
                    <div class="subagent-header">
                        <div class="subagent-icon">üõ°Ô∏è</div>
                        <div>
                            <div class="subagent-name">Safety Monitor</div>
                            <div class="subagent-status">Standby</div>
                        </div>
                    </div>
                    <div class="subagent-stats">
                        <span>Checks: 156</span>
                        <span>Alerts: 0</span>
                    </div>
                </div>
                <div class="subagent-card active" data-agent="recorder">
                    <div class="subagent-header">
                        <div class="subagent-icon">üìπ</div>
                        <div>
                            <div class="subagent-name">Recorder</div>
                            <div class="subagent-status">Recording</div>
                        </div>
                    </div>
                    <div class="subagent-stats">
                        <span>Episodes: 24</span>
                        <span>Size: 1.2GB</span>
                    </div>
                </div>
                <div class="subagent-card" data-agent="vision">
                    <div class="subagent-header">
                        <div class="subagent-icon">üëÅÔ∏è</div>
                        <div>
                            <div class="subagent-name">Vision</div>
                            <div class="subagent-status">Active</div>
                        </div>
                    </div>
                    <div class="subagent-stats">
                        <span>FPS: 30</span>
                        <span>Objects: 5</span>
                    </div>
                </div>
                <div class="subagent-card" data-agent="memory">
                    <div class="subagent-header">
                        <div class="subagent-icon">üíæ</div>
                        <div>
                            <div class="subagent-name">Memory</div>
                            <div class="subagent-status">Active</div>
                        </div>
                    </div>
                    <div class="subagent-stats">
                        <span>Entries: 342</span>
                        <span>Relevant: 12</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Memory Context -->
        <div class="memory-panel">
            <div class="task-header">
                <div class="task-title">
                    <span>üí≠</span>
                    <span>Active Memory Context</span>
                </div>
            </div>
            <div class="memory-items" id="memory-items">
                <div class="memory-item">
                    <span class="memory-icon">üìç</span>
                    <div class="memory-content">
                        <div class="memory-text">Currently in the living room near the sofa</div>
                        <div class="memory-meta">Location context - 2 min ago</div>
                    </div>
                </div>
                <div class="memory-item">
                    <span class="memory-icon">üë§</span>
                    <div class="memory-content">
                        <div class="memory-text">User preference: Prefers concise responses</div>
                        <div class="memory-meta">User context - learned from 5 conversations</div>
                    </div>
                </div>
                <div class="memory-item">
                    <span class="memory-icon">‚è∞</span>
                    <div class="memory-content">
                        <div class="memory-text">Last task completed: Navigated to kitchen</div>
                        <div class="memory-meta">Task history - 15 min ago</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Panel -->
    <div class="agent-chat-panel">
        <div class="chat-panel-header">
            <span class="chat-panel-title">üí¨ Chat with HOPE</span>
            <div class="chat-mode-toggle">
                <button class="chat-mode-btn active" data-mode="chat" onclick="setChatMode('chat')">Chat</button>
                <button class="chat-mode-btn" data-mode="command" onclick="setChatMode('command')">Command</button>
            </div>
        </div>
        <div class="quick-actions">
            <button class="quick-action-btn" onclick="sendQuickAction('What can you do?')">What can you do?</button>
            <button class="quick-action-btn" onclick="sendQuickAction('Check status')">Check status</button>
            <button class="quick-action-btn" onclick="sendQuickAction('Go to kitchen')">Go to kitchen</button>
            <button class="quick-action-btn" onclick="sendQuickAction('Describe what you see')">What do you see?</button>
        </div>
        <div class="chat-messages-panel" id="agent-chat-messages">
            <div class="chat-msg agent">
                Hello! I'm HOPE, your Hierarchical Open-ended Progression Engine. I can help you control the robot, answer questions, and learn from our interactions. What would you like to do?
            </div>
        </div>
        <div class="chat-input-panel">
            <div class="chat-input-row">
                <input type="text" class="chat-text-input" id="agent-chat-input"
                       placeholder="Message HOPE..."
                       onkeypress="if(event.key==='Enter') sendAgentMessage()">
                <button class="chat-voice-btn" id="voice-btn" onclick="toggleVoiceInput()">üé§</button>
                <button class="chat-send-btn" onclick="sendAgentMessage()">Send</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
// Agent page logic
let chatMode = 'chat';
let currentThoughtTab = 'live';

function setChatMode(mode) {
    chatMode = mode;
    document.querySelectorAll('.chat-mode-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.mode === mode);
    });
}

function switchThoughtTab(tab) {
    currentThoughtTab = tab;
    document.querySelectorAll('.thought-tab').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.tab === tab);
    });
    // Filter thought items based on tab
    filterThoughts(tab);
}

function filterThoughts(tab) {
    const stream = document.getElementById('thought-stream');
    stream.querySelectorAll('.thought-item').forEach(item => {
        const type = item.querySelector('.thought-type');
        if (!type) return;
        const typeClass = type.classList[1];

        if (tab === 'live') {
            item.style.display = '';
        } else if (tab === 'reasoning' && typeClass === 'reasoning') {
            item.style.display = '';
        } else if (tab === 'actions' && typeClass === 'action') {
            item.style.display = '';
        } else if (tab !== 'live') {
            item.style.display = 'none';
        }
    });
}

async function sendAgentMessage() {
    const input = document.getElementById('agent-chat-input');
    const message = input.value.trim();
    if (!message) return;

    // Add user message
    const messagesDiv = document.getElementById('agent-chat-messages');
    messagesDiv.innerHTML += `<div class="chat-msg user">${escapeHtml(message)}</div>`;
    input.value = '';
    messagesDiv.scrollTop = messagesDiv.scrollHeight;

    // Update task status
    updateTaskStatus('thinking', 'Processing your request...');

    // Add thought
    addThought('observation', 'Received user message: ' + message.substring(0, 50) + '...');

    // Send to API
    try {
        const response = await fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message, mode: chatMode })
        });
        const data = await response.json();
        const reply = data.response || data.message || 'I processed your request.';

        messagesDiv.innerHTML += `<div class="chat-msg agent">${escapeHtml(reply)}</div>`;
        messagesDiv.scrollTop = messagesDiv.scrollHeight;

        addThought('action', 'Sent response to user');
        updateTaskStatus('idle', 'No active task. Ask me to do something!');
    } catch (error) {
        messagesDiv.innerHTML += `<div class="chat-msg system">Error: ${error.message}</div>`;
        addThought('error', 'Failed to process: ' + error.message);
        updateTaskStatus('idle', 'Error occurred.');
    }
}

function sendQuickAction(action) {
    document.getElementById('agent-chat-input').value = action;
    sendAgentMessage();
}

function addThought(type, content) {
    const stream = document.getElementById('thought-stream');
    const now = new Date();
    const timestamp = now.toTimeString().split(' ')[0];

    const thought = document.createElement('div');
    thought.className = 'thought-item';
    thought.innerHTML = `
        <div class="thought-timestamp">${timestamp}</div>
        <div class="thought-content">
            <span class="thought-type ${type}">${type.charAt(0).toUpperCase() + type.slice(1)}</span>
            ${escapeHtml(content)}
        </div>
    `;
    stream.insertBefore(thought, stream.firstChild);

    // Keep only last 50 thoughts
    while (stream.children.length > 50) {
        stream.removeChild(stream.lastChild);
    }
}

function updateTaskStatus(status, description) {
    const statusEl = document.getElementById('task-status');
    statusEl.className = 'task-status ' + status;
    statusEl.textContent = status.charAt(0).toUpperCase() + status.slice(1);

    document.getElementById('task-description').textContent = description;
}

function toggleVoiceInput() {
    const btn = document.getElementById('voice-btn');
    if (btn.classList.contains('recording')) {
        btn.classList.remove('recording');
        btn.textContent = 'üé§';
        // Stop recording
    } else {
        btn.classList.add('recording');
        btn.textContent = 'üî¥';
        // Start recording
    }
}

async function loadAgentStatus() {
    try {
        const response = await fetch('/api/status');
        const data = await response.json();

        // Update metrics
        if (data.loop_metrics && data.loop_metrics.hope_loops) {
            const fast = data.loop_metrics.hope_loops.fast;
            if (fast) {
                document.getElementById('metric-latency').textContent = Math.round(1000 / fast.hz) + 'ms';
            }
        }

        // Update mode badges
        if (data.mode === 'autonomous') {
            document.getElementById('agent-autonomous-badge').classList.add('active');
        } else {
            document.getElementById('agent-autonomous-badge').classList.remove('active');
        }
    } catch (error) {
        console.error('Failed to load agent status:', error);
    }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    loadAgentStatus();
    setInterval(loadAgentStatus, 5000);
});
{% endblock %}
