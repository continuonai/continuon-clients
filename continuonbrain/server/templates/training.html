{% extends "base.html" %}

{% block content %}
<div class="panel">
    <div class="panel-header">
        <h2>Training Control Center</h2>
        <div class="status-badge" id="training-status-badge">Unknown</div>
    </div>
    <div class="panel-content">
        <div class="rail-actions">
            <button class="rail-btn primary" onclick="startAutonomousTraining()">‚ñ∂ Start Autonomous Training</button>
            <button class="rail-btn" onclick="startManualTraining()">üõ† Start Manual Training Step</button>
            <button class="rail-btn input-warn" onclick="testManualTraining()">üß™ Test Manual Training</button>
            <button class="rail-btn" onclick="stopTraining()">‚èπ Stop Training</button>
        </div>
        <div style="margin-top: 15px;">
            <h3>WaveCore Loops</h3>
            <div class="rail-actions">
                <button class="rail-btn" onclick="runWaveCoreLoop('fast')">‚ö° Run Fast Loop</button>
                <button class="rail-btn" onclick="runWaveCoreLoop('mid')">üåä Run Mid Loop</button>
                <button class="rail-btn" onclick="runWaveCoreLoop('slow')">üê¢ Run Slow Loop</button>
            </div>
        </div>
    </div>
</div>

<div class="panel">
    <div class="panel-header">
        <h2>Real-time Metrics</h2>
        <button class="rail-btn" onclick="refreshMetrics()">‚Üª Refresh</button>
    </div>
    <div class="panel-content">
        <div class="status-grid" id="metrics-grid">
            <div class="status-item">
                <label>Loss</label>
                <span id="metric-loss">--</span>
            </div>
            <div class="status-item">
                <label>Accuracy</label>
                <span id="metric-accuracy">--</span>
            </div>
            <div class="status-item">
                <label>Steps</label>
                <span id="metric-steps">--</span>
            </div>
            <div class="status-item">
                <label>Episode Reward</label>
                <span id="metric-reward">--</span>
            </div>
        </div>
        <div id="full-metrics-json"
            style="margin-top: 20px; white-space: pre-wrap; font-family: monospace; background: #111; padding: 10px; border-radius: 4px; display: none;">
        </div>
    </div>
</div>

<div class="panel">
    <div class="panel-header">
        <div>
            <h2>Seed Bundle</h2>
            <div class="stack-meta">Offline-first export/install helpers for cloud or edge handoffs.</div>
        </div>
        <div class="status-badge" id="seed-readiness-chip">Checking‚Ä¶</div>
    </div>
    <div class="panel-content">
        <div class="stack" id="seed-readiness-gates">
            <div class="stack-item"><span class="stack-meta">Running readiness check‚Ä¶</span></div>
        </div>
        <div class="stack-meta" id="seed-readiness-meta"></div>

        <div class="panel-subtitle" style="margin-top: 16px;">Export seed bundle</div>
        <div class="form-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px;">
            <label class="input-group"><input type="checkbox" id="cloud-export-episodes" checked> Episodes (RLDS)</label>
            <label class="input-group"><input type="checkbox" id="cloud-export-seed" checked> Seed export</label>
            <label class="input-group"><input type="checkbox" id="cloud-export-checkpoints" checked> Checkpoints</label>
            <label class="input-group"><input type="checkbox" id="cloud-export-tfrecord"> TFRecord cache</label>
            <label class="input-group" style="grid-column: span 2;">
                Export name
                <input id="seed-export-name" type="text" placeholder="cloud_handoff_<timestamp>.zip">
            </label>
            <label class="input-group" style="grid-column: span 2;">
                Episode limit (optional)
                <input id="cloud-export-episode-limit" type="number" min="1" placeholder="All recent episodes">
            </label>
        </div>
        <div class="rail-actions" style="margin-top: 10px;">
            <button class="rail-btn" onclick="buildSeedExportZip()">‚¨á Build export zip</button>
            <button class="rail-btn" onclick="listSeedExports()">‚Üª Refresh exports</button>
        </div>
        <div class="stack-meta" id="cloud-export-status"></div>
        <div class="stack" id="cloud-export-list"></div>

        <div class="panel-subtitle" style="margin-top: 18px;">Install bundle</div>
        <div class="form-grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 10px;">
            <label class="input-group">
                Kind
                <select id="cloud-install-kind">
                    <option value="jax_seed_manifest">JAX seed manifest</option>
                    <option value="edge_bundle">Edge bundle (edge_manifest.json)</option>
                    <option value="vertex_edge">Vertex Edge (auto-detect)</option>
                </select>
            </label>
            <label class="input-group">
                Source URL (requires readiness)
                <input id="cloud-install-url" type="url" placeholder="https://.../bundle.zip">
            </label>
            <label class="input-group">
                Local path
                <input id="cloud-install-path" type="text" placeholder="/opt/continuonos/brain/exports/my_bundle.zip">
            </label>
            <label class="input-group">
                Path helper (pi5 defaults)
                <select id="seed-path-helper" onchange="applySeedPathHelper(this.value)">
                    <option value="">Select a helper‚Ä¶</option>
                    <option value="candidate-manifest">Candidate seed manifest (core_model_seed)</option>
                    <option value="default-manifest">Example manifest (pi5)</option>
                    <option value="adapter-dir">Current adapter dir (pi5)</option>
                </select>
            </label>
        </div>
        <div class="rail-actions" style="margin-top: 10px;">
            <button class="rail-btn primary" onclick="installSeedBundle()">‚¨Ü Install bundle</button>
            <button class="rail-btn" onclick="refreshSeedReadiness()">‚Üª Re-run readiness</button>
        </div>
        <div class="stack-meta" id="cloud-install-status"></div>
    </div>
</div>

<div class="panel">
    <div class="panel-header">
        <h2>Training Logs</h2>
        <button class="rail-btn" onclick="refreshLogs()">‚Üª Refresh Logs</button>
    </div>
    <div class="panel-content">
        <pre id="training-logs"
            style="height: 300px; overflow-y: auto; background: #000; color: #0f0; padding: 10px; border-radius: 4px; font-family: monospace;">Waiting for logs...</pre>
    </div>
</div>

<script src="/static/training.js?v=test3"></script>
{% endblock %}